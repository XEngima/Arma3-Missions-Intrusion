/*
 * Name:	ResourceCollectorTests
 * Date:	2019-04-11
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * Tests for the ResourceCollector object.
 */

using Sqx.UnitTest;
using Intrusion.Common;
using Intrusion.Server;
using Intrusion.Tests.Helpers;

namespace Intrusion.Tests.Server
{
	public class ResourceCollectorTests
	{
		private static fields ["_mMissionTime" as TestMissionTime, "_mResourceCollector" as ResourceCollector, "_mResourceBook" as ResourceBook, "_mUnitCounter" as IUnitCounter];
	
		// Creates a ReservationQueueTests object.
		public static method Init {
			["Intrusion.Tests.Server", "ResourceCollectorTests", [
				"ReservationQueueEmpty_NothingChanged_CurrentIsNull"
			]] call TestEngine.Register;
		};
		
		private static method BeforeEach {
			_mMissionTime = new TestMissionTime;
			_mResourceBook = new ResourceBook;
			_mUnitCounter = [60, 30, 60] new TestUnitCounter;
			_mResourceCollector = [_mMissionTime, new TestGameplayConfig, 60, west, _mResourceBook, _mUnitCounter] new ResourceCollector;
		};
		
		private static method FullServer_60Minutes_Correct {
			// Arrange
			_mMissionTime.MissionTime = 60 * 60; // After 60 minutes
						
			// Act
			call _mResourceCollector.CollectResources;
			
			// Assert
			[1000, _mResourceBook.TotalProduction, "Wrong production amount."] call Assert.AreEqual;
			[1000, _mResourceBook.TotalResearch, "Wrong administration amount."] call Assert.AreEqual;
		};
	};
};
