/*
 * Name:	ProfessionDialogHandler
 * Date:	2017-11-30
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * Handles all about the profession dialog.
 */
using Intrusion.Common;

namespace Intrusion.Client
{
	public class ProfessionDialogHandler
	{
		private static fields ["_mVisibleDialog" as ProfessionDialog];
	
		// Creates a ProfessionDialogHandler object.
		public static method Init {
			private ["_trigger" as Object];
			_mVisibleDialog = new ProfessionDialog;
			
			// Create the profession dialog trigger
            _trigger = createTrigger ["EmptyDetector", [0, 0, 0]];
            _trigger setTriggerActivation ["ALPHA", "PRESENT", true];
            _trigger setTriggerText "Open group dialog";
            _trigger setTriggerStatements ["this", "[] spawn Intrusion_Client_ProfessionDialogHandler_ShowDialog;", ""];
		};
		
		public static method ShowDialog {
			[] call _mVisibleDialog.ShowDialog;
		};
		
		// Shows the profession dialog.
		public static method OnOkButtonPressed {
			private ["_profession" as Profession];
			["ProfessionDialogHandler.OnOkButtonPressedStatic"] call LogHandler.Debug;
			
			private _selectedIndex = lbCurSel (DialogControl.GroupProfessionCombo as Scalar);
			_profession = (call ProfessionConfig.GetAllProfessions) select _selectedIndex;
			_mVisibleDialog.SelectedProfession = _profession.Type;
			
			["GroupHandler.SetGroupProfession", [group player, _mVisibleDialog.SelectedProfession]] call Remote.Invoke;
		};
		
		public static method CloseDialog {
			closeDialog 0;
		};
		
		// Notifies the members in affected group that their profession is  changed.
		// Called from server when a group's profession has changed.
		// _group (Group): The group that has changed profession.
		// _professionType (ProfessionType): The new profession type.
		public static method OnGroupProfessionChangeRejected {
			params ["_group" as Group, "_professionType" as ProfessionType];
			[(str _this) + " ClientGroupHandler.OnGroupProfessionChanged"] call LogHandler.Debug;
			
			if (_group == group player) then {
				call ProfessionDialogHandler.CloseDialog;
				["Your group now belongs to the brigade's " + ([_professionType] call ProfessionConfig.GetProfession).Name] call ClientMessageHandler.ShowMessage;
			};
		};
	};
};
