/*
 * Name:	ResourceCollectorTests
 * Date:	2019-04-11
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * Tests for the ResourceCollector object.
 */

using Sqx.UnitTest;
using Intrusion.Common;
using Intrusion.Server;
using Intrusion.Tests.Helpers;

namespace Intrusion.Tests.Server
{
	public class ResourceCollectorTests
	{
		private static fields ["_mMissionTime" as TestMissionTime, "_mResourceCollector" as ResourceCollector, "_mResourceBook" as ResourceBook, "_mUnitCounter" as TestUnitCounter, "_mResourceLocationHandler" as IResourceLocationHandler];
	
		// Creates a ReservationQueueTests object.
		public static method Init
		{
			["Intrusion.Tests.Server", "ResourceCollectorTests", [
				"FullServer_60Minutes_Correct",
				"FullServer_30Minutes_Correct",
				"HalfServer_60Minutes_Correct",
				"HalfServer_30Minutes_Correct"
			]] call TestEngine.Register;
		};
		
		private static method BeforeEach
		{
			_mMissionTime = new TestMissionTime;
			_mResourceBook = new ResourceBook;
			_mUnitCounter = [60, 30, 60] new TestUnitCounter;
			_mResourceLocationHandler = [3, 3, 0, 0] new TestResourceLocationHandler;
			_mResourceCollector = [_mMissionTime, new TestGameplayConfig, _mResourceLocationHandler, 60, west, _mResourceBook, _mUnitCounter] new ResourceCollector;
		};
		
		private static method FullServer_60Minutes_Correct
		{
			// Arrange
			_mMissionTime.MissionTime = 60 * 60;
						
			// Act
			call _mResourceCollector.CollectResources;
			
			// Assert
			[1000, _mResourceBook.TotalProduction, "Wrong production amount."] call Assert.AreEqual;
			[1000, _mResourceBook.TotalResearch, "Wrong administration amount."] call Assert.AreEqual;
		};
		
		private static method FullServer_30Minutes_Correct {
			// Arrange
			_mMissionTime.MissionTime = 30 * 60;
						
			// Act
			call _mResourceCollector.CollectResources;
			
			// Assert
			[500, _mResourceBook.TotalProduction, "Wrong production amount."] call Assert.AreEqual;
			[500, _mResourceBook.TotalResearch, "Wrong administration amount."] call Assert.AreEqual;
		};
		
		private static method HalfServer_60Minutes_Correct {
			// Arrange
			_mUnitCounter.UnitsInPlay = 30;
			_mUnitCounter.UnitsInPlaySide = 15;
			_mMissionTime.MissionTime = 60 * 60;
						
			// Act
			call _mResourceCollector.CollectResources;
			
			// Assert
			[500, _mResourceBook.TotalProduction, "Wrong production amount."] call Assert.AreEqual;
			[500, _mResourceBook.TotalResearch, "Wrong administration amount."] call Assert.AreEqual;
		};
		
		private static method HalfServer_30Minutes_Correct {
			// Arrange
			_mUnitCounter.UnitsInPlay = 30;
			_mUnitCounter.UnitsInPlaySide = 15;
			_mMissionTime.MissionTime = 30 * 60;
						
			// Act
			call _mResourceCollector.CollectResources;
			
			// Assert
			[250, _mResourceBook.TotalProduction, "Wrong production amount."] call Assert.AreEqual;
			[250, _mResourceBook.TotalResearch, "Wrong administration amount."] call Assert.AreEqual;
		};
	};
};
