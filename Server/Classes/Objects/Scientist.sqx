/*
 * Name:	Scientist
 * Date:	2017-11-19
 * Version: 1.0
 * Author:  Engima
 *
 * Description:
 * A class modeling a side's R&D manager refining generated technoloty (i.e. unlocks new technology).
 */

using Intrusion.Common;

namespace Intrusion.Server
{
	public class Scientist
	{
		private fields ["_mResourceBook" as ResourceBook, "_mTechnologyConfig" as ITechnologyConfig, "_mMessageHandler" as IMessageHandler];
		private fields ["_mInventedTechnologies" as Array /* of (enum) Technology */, "_mSide" as Side, "_mPreviousResearch" as Scalar];
	
		// Creates a Sceintist object.
		public constructor("_side" as Side, "_resourceBook" as ResourceBook, "_technologyConfig" as ITechnologyConfig, "_messageHandler" as IMessageHandler)
		{
			_mSide = _side;
			_mResourceBook = _resourceBook;
			_mTechnologyConfig = _technologyConfig;
			_mMessageHandler = _messageHandler;
			
			_previousResearch = 0;
			_mInventedTechnologies = [];
		};
		
		// Performs research and development, and notifies players when different technology progress steps are achieved.
		public method PerformResearch()
		{
			params ["_technology" as TechnologyInfo];
			
			_technology = [Technology.Transport] call _mTechnologyConfig.GetTechnology;

			if (_mResourceBook.TotalResearch >= _technology.RequiredResearch) then {
				_mInventedTechnologies pushBack Technology.Transport;
				["Your side has invented 'Transport'", _mSide] call _mMessageHandler.ShowHint;
			};
			
			_mPreviousResearch = _technology.RequiredResearch;
		};
		
		// Gets whether a technology is invented yet or not.
		public method Boolean TechnologyIsInvented("_technology" as Technology)
		{
			_technology in _mInventedTechnologies
		};
	};
};
